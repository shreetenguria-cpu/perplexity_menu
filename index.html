<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shreeji Digital Menu</title>
<link rel="manifest" href="manifest.json">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#f8f9fa}

/* Header */
.header{position:sticky;top:0;background:#fff;z-index:100;padding:1rem;box-shadow:0 2px 10px rgba(0,0,0,.1)}
.logo{font-size:1.5rem;font-weight:700}
.search{width:100%;padding:.7rem;border-radius:25px;border:1px solid #ddd;margin:.8rem 0}

/* Categories */
.categories{display:flex;gap:.5rem;overflow-x:auto;padding:.5rem 0}
.category{padding:.4rem 1rem;border-radius:20px;background:#eee;white-space:nowrap;cursor:pointer}
.category.active{background:#ff6b35;color:#fff}

/* Menu */
.menu-grid{padding:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1rem}
.item-card{background:#fff;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1);overflow:hidden}
.item-image{height:120px;background:#ddd}
.item-image img{width:100%;height:100%;object-fit:cover}
.item-name{padding:.6rem;font-weight:600}
.item-price{padding:0 .6rem .6rem;color:#ff6b35;font-weight:700}
.add-btn{width:100%;padding:.6rem;border:none;background:#ff6b35;color:#fff;font-weight:600}

/* Cart */
.cart-bar{position:fixed;bottom:0;left:0;right:0;background:#fff;padding:1rem;box-shadow:0 -4px 10px rgba(0,0,0,.1);display:none}
.cart-bar.show{display:block}
.checkout-btn{background:#28a745;color:#fff;padding:.8rem;text-align:center;border-radius:10px;font-weight:600}

/* Loader */
.loader{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:1000}
.loader.show{display:flex}
.spinner{width:50px;height:50px;border:4px solid #eee;border-top:4px solid #ff6b35;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="header">
  <div class="logo" id="brandLogo"></div>
  <input class="search" id="search" placeholder="Search items">
  <div class="categories" id="categories"></div>
</div>

<div class="menu-grid" id="menu"></div>

<div class="cart-bar" id="cartBar">
  <div style="display:flex;justify-content:space-between">
    <span>Cart <b id="count">0</b></span>
    <span id="total">â‚¹0</span>
  </div>
  <div class="checkout-btn" onclick="checkout()">Send to Kitchen</div>
</div>

<div class="loader" id="loader"><div class="spinner"></div></div>

<script>
/* ---------------- CONFIG ---------------- */
const BRAND_CONFIG = {
  cafe: {
    name: "â˜• Shreeji Cafe",
    color: "#ff6b35",
    menuURL: "https://script.google.com/macros/s/AKfycbz2x-z27L-qt_pQyZ8mDy-Nw-SmbM-U4FLrNtE9FRkWgoN2vHn0eHjOTc6E_5UgV_fU/exec?action=menu&brand=cafe"
  },
  restaurant: {
    name: "ðŸ½ï¸ Shreeji Restaurant",
    color: "#c0392b",
    menuURL: "https://script.google.com/macros/s/AKfycbz2x-z27L-qt_pQyZ8mDy-Nw-SmbM-U4FLrNtE9FRkWgoN2vHn0eHjOTc6E_5UgV_fU/exec?action=menu&brand=restaurant"
  },
  pizzaghar: {
    name: "ðŸ• PizzaGhar",
    color: "#27ae60",
    menuURL: "https://script.google.com/macros/s/AKfycbz2x-z27L-qt_pQyZ8mDy-Nw-SmbM-U4FLrNtE9FRkWgoN2vHn0eHjOTc6E_5UgV_fU/exec?action=menu&brand=pizzaghar"
  }
};

/* ---------------- STATE ---------------- */
const params = new URLSearchParams(location.search);
const brandKey = params.get("brand") || "restaurant";
const table = params.get("table") || "NA";
const BRAND = BRAND_CONFIG[brandKey];

let menu = [];
let cart = JSON.parse(localStorage.getItem(`cart_${brandKey}_${table}`) || "[]");
let currentCategory = "All";

/* ---------------- INIT ---------------- */
document.getElementById("brandLogo").textContent = BRAND.name;
document.documentElement.style.setProperty("--brand", BRAND.color);

loadMenu();

/* ---------------- MENU ---------------- */
async function loadMenu(){
  try{
    const res = await fetch(BRAND.menuURL,{cache:"no-cache"});
    const data = await res.json();
    menu = normalizeMenu(data);
  }catch{
    menu = normalizeMenu([
      {id:1,name:"Sample Item",category:"General",price:100,image:"https://via.placeholder.com/300"}
    ]);
  }
  renderCategories();
  renderMenu();
}

function normalizeMenu(data){
  return data.map(i=>Array.isArray(i)?{
    id:i[0],name:i[1],category:i[2],price:+i[3],image:i[5]
  }:i);
}

function renderCategories(){
  const cats=["All",...new Set(menu.map(i=>i.category))];
  categories.innerHTML=cats.map(c=>
    `<div class="category ${c==="All"?"active":""}" onclick="setCat('${c}',this)">${c}</div>`
  ).join("");
}

function setCat(cat,el){
  currentCategory=cat;
  document.querySelectorAll(".category").forEach(x=>x.classList.remove("active"));
  el.classList.add("active");
  renderMenu();
}

function renderMenu(){
  menu.innerHTML="";
  document.getElementById("menu").innerHTML=
    menu.filter(i=>currentCategory==="All"||i.category===currentCategory)
    .map(i=>`
      <div class="item-card">
        <div class="item-image"><img src="${i.image}"></div>
        <div class="item-name">${i.name}</div>
        <div class="item-price">â‚¹${i.price}</div>
        <button class="add-btn" onclick="add(${i.id})">ADD</button>
      </div>
    `).join("");
}

/* ---------------- CART ---------------- */
function add(id){
  const item=menu.find(i=>i.id===id);
  const c=cart.find(i=>i.id===id);
  c?c.qty++:cart.push({...item,qty:1});
  updateCart();
}

function updateCart(){
  const count=cart.reduce((a,b)=>a+b.qty,0);
  const total=cart.reduce((a,b)=>a+b.qty*b.price,0);
  countEl.textContent=count;
  totalEl.textContent="â‚¹"+total;
  cartBar.classList.toggle("show",count>0);
  localStorage.setItem(`cart_${brandKey}_${table}`,JSON.stringify(cart));
}

const countEl=document.getElementById("count");
const totalEl=document.getElementById("total");
const cartBar=document.getElementById("cartBar");

/* ---------------- CHECKOUT ---------------- */
async function checkout(){
  if(!cart.length)return;
  loader.classList.add("show");
  try{
    await fetch("https://script.google.com/macros/s/AKfycbz2x-z27L-qt_pQyZ8mDy-Nw-SmbM-U4FLrNtE9FRkWgoN2vHn0eHjOTc6E_5UgV_fU/exec",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({action:"placeOrder",brand:brandKey,table,items:cart})
    });
    alert("Order sent to kitchen");
    cart=[];
    updateCart();
  }catch{
    alert("Offline: Order saved");
  }finally{
    loader.classList.remove("show");
  }
}
</script>

</body>
</html>
